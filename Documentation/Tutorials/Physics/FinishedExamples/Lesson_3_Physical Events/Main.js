"use strict";
//Reference Fudge, getting code completion ready and creating a shortcut f to write FudgeCode more comfortably
var Tutorials_FUDGEPhysics_Lesson1;
//Reference Fudge, getting code completion ready and creating a shortcut f to write FudgeCode more comfortably
(function (Tutorials_FUDGEPhysics_Lesson1) {
    var f = FudgeCore;
    //Goal: Learn how to create and use physics based events (Collision/Trigger) to control nodes in the app.
    //Fudge Basic Variables
    window.addEventListener("load", init);
    const app = document.querySelector("canvas"); // The html element where the scene is drawn to
    let viewPort; // The scene visualization
    let hierarchy; // You're object scene tree
    //Physical Objects
    let bodies = new Array(); // Array of all physical objects in the scene to have a quick reference
    let playerBody; // Transform of a body that interacts with physics but can be moved by normal FudgeTransform
    //Setting Variables
    let force = 0.5; //The amount of movement with each keypress
    let playerDefaultMat = new f.Material("Cube", f.ShaderFlat, new f.CoatColored(new f.Color(0, 0, 1, 1)));
    let playerTriggeredMat = new f.Material("CubeTriggered", f.ShaderFlat, new f.CoatColored(new f.Color(0.9, 0.1, 0.1, 1)));
    //Function to initialize the Fudge Scene with a camera, light, viewport and PHYSCIAL Objects
    function init(_event) {
        hierarchy = new f.Node("Scene"); //create the root Node where every object is parented to. Should never be changed
        //#region PHYSICS
        //PHYSICS - Step 2: Create some physical Nodes to play with 
        //Creating a physically static ground plane for our physics playground. A simple scaled cube but with physics type set to static
        bodies[0] = createCompleteNode("Ground", new f.Material("Ground", f.ShaderFlat, new f.CoatColored(new f.Color(0.2, 0.2, 0.2, 1))), new f.MeshCube(), 0, f.PHYSICS_TYPE.STATIC);
        bodies[0].mtxLocal.scale(new f.Vector3(14, 0.3, 14)); //Scale the body with it's standard ComponentTransform
        bodies[0].mtxLocal.rotateX(4, true); //Give it a slight rotation so the physical objects are sliding, always from left when it's after a scaling
        hierarchy.appendChild(bodies[0]); //Add the node to the scene by adding it to the scene-root
        //Step 1 - Creating a the player cube - to interact to trigger, COLLIDERS and TRIGGERS 
        bodies[1] = createCompleteNode("Player", playerDefaultMat, new f.MeshCube(), 1, f.PHYSICS_TYPE.DYNAMIC);
        playerBody = bodies[1]; //Reference this node specifically so we can access it for input more easily
        playerBody.mtxLocal.translate(new f.Vector3(0, 1, 0));
        hierarchy.appendChild(bodies[1]);
        playerBody.getComponent(f.ComponentRigidbody).rotationInfluenceFactor = new f.Vector3(0, 0, 0); //make rotation fixed the player does not rotate
        playerBody.getComponent(f.ComponentRigidbody).friction = 1;
        //Step 2 - Create bodies - one used as a button when it collides it will an action will happen - one as a trigger, when it's overlapping it will trigger an action
        //The Collision Event is happening on a collision so a normal body can receive it
        //A use case for a collision event is for example when the player is hitting the ground to play a sound
        bodies[2] = createCompleteNode("Collider_Button", new f.Material("Collider_Button", f.ShaderFlat, new f.CoatColored(new f.Color(0.3, 0.3, 0.4, 1))), new f.MeshCube(), 1, f.PHYSICS_TYPE.STATIC);
        bodies[2].mtxLocal.translate(new f.Vector3(-3, 1, 0));
        hierarchy.appendChild(bodies[2]);
        //The Trigger Event is happening when bodies overlap, so we need a special body that does not collide but overlap
        //So it must be in the PHYSICS_GROUP.TRIGGER, and normally it's invisble, so it has no mesh component or is fully transparent
        //A use case is something like spawning enemies when a player enters a room.
        bodies[3] = createCompleteNode("Trigger_Button", new f.Material("Trigger_Button", f.ShaderFlat, new f.CoatColored(new f.Color(0.5, 0.3, 0.2, 0.3))), new f.MeshCube(), 1, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.TRIGGER);
        bodies[3].mtxLocal.translate(new f.Vector3(3, 1, 0));
        hierarchy.appendChild(bodies[3]);
        //Trigger when player is falling of the plane
        bodies[4] = createCompleteNode("Trigger_Reset", new f.Material("Trigger_Reset", f.ShaderFlat, new f.CoatColored(new f.Color(0.5, 0.3, 0.2, 0.3))), new f.MeshCube(), 1, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.TRIGGER);
        bodies[4].removeComponent(bodies[4].getComponent(f.ComponentMesh)); //removing the mesh to have invisible trigger - standard practice
        bodies[4].mtxLocal.translate(new f.Vector3(0, -4, 0));
        bodies[4].mtxLocal.scale(new f.Vector3(30, 1, 30)); //Make it big enough so the player should hit it
        hierarchy.appendChild(bodies[4]);
        //Step 3 - After creating our Physic Event Bodies, we tell them to listen to the specific event happening
        //These events are happening on the physic component not on the node. So be sure to add them to the component not to the node
        //A body can receive a enter/exit event, and it's only happening once. If a body is staying on a collision or in a trigger it needs to be handled manually
        bodies[2].getComponent(f.ComponentRigidbody).addEventListener("ColliderEnteredCollision" /* COLLISION_ENTER */, hndCollisionEventEnter);
        bodies[2].getComponent(f.ComponentRigidbody).addEventListener("ColliderLeftCollision" /* COLLISION_EXIT */, hndCollisionEventExit);
        /*Hint: The Collision Event is only happening if the object is hitting it physically,
          So KINEMATIC vs. STATIC does not receive a collision Event. Only DYNAMIC vs. DYNAMIC/STATIC/KINEMATIC, neither do two Kinematic hit each other nor do Kinematic/Static.
          If you really need a kinematic hitting a static object and still have a action, use trigger, or make the object not static but dynamic but unmoving by having a ridiculously high weight.
          Thats why we use a dynamic player cube instead of a kinematic like we did in Lesson 1.
        */
        //Same as for collision a trigger is also listening on a event type in form of f.EVENT_PHYSICS and a function that will be called
        bodies[3].getComponent(f.ComponentRigidbody).addEventListener("TriggerEnteredCollision" /* TRIGGER_ENTER */, hndTriggerEventEnter);
        bodies[3].getComponent(f.ComponentRigidbody).addEventListener("TriggerLeftCollision" /* TRIGGER_EXIT */, hndTriggerEventExit);
        //Setting up our reset
        bodies[4].getComponent(f.ComponentRigidbody).addEventListener("TriggerEnteredCollision" /* TRIGGER_ENTER */, hndResetTrigger);
        //#endregion PHYSICS
        //Standard Fudge Scene Initialization - Creating a directional light, a camera and initialize the viewport
        let cmpLight = new f.ComponentLight(new f.LightDirectional(f.Color.CSS("WHITE")));
        cmpLight.mtxPivot.lookAt(new f.Vector3(0.5, -1, -0.8)); //Set light direction
        hierarchy.addComponent(cmpLight);
        let cmpCamera = new f.ComponentCamera();
        cmpCamera.clrBackground = f.Color.CSS("GREY");
        cmpCamera.mtxPivot.translate(new f.Vector3(2, 3.5, 17)); //Move camera far back so the whole scene is visible
        cmpCamera.mtxPivot.lookAt(f.Vector3.ZERO()); //Set the camera matrix so that it looks at the center of the scene
        viewPort = new f.Viewport(); //Creating a viewport that is rendered onto the html canvas element
        viewPort.initialize("Viewport", hierarchy, cmpCamera, app); //initialize the viewport with the root node, camera and canvas
        document.addEventListener("keypress", hndKey); //Adding a listener for keypress handling
        //PHYSICS - Start using physics by telling the physics the scene root object. Physics will recalculate every transform and initialize
        f.Physics.adjustTransforms(hierarchy);
        //Important start the game loop after starting physics, so physics can use the current transform before it's first iteration
        f.Loop.addEventListener("loopFrame" /* LOOP_FRAME */, update); //Tell the game loop to call the update function on each frame
        f.Loop.start(); //Stard the game loop
    }
    //Function to animate/update the Fudge scene, commonly known as gameloop
    function update() {
        f.Physics.world.simulate(); //PHYSICS - Simulate physical changes each frame, parameter to set time between frames
        viewPort.draw(); // Draw the current Fudge Scene to the canvas
    }
    // Function to quickly create a node with multiple needed FudgeComponents, including a physics component
    function createCompleteNode(_name, _material, _mesh, _mass, _physicsType, _group = f.PHYSICS_GROUP.DEFAULT, _colType = f.COLLIDER_TYPE.CUBE) {
        let node = new f.Node(_name); //Creating the node
        let cmpMesh = new f.ComponentMesh(_mesh); //Creating a mesh for the node
        let cmpMaterial = new f.ComponentMaterial(_material); //Creating a material for the node
        let cmpTransform = new f.ComponentTransform(); //Transform holding position/rotation/scaling of the node
        let cmpRigidbody = new f.ComponentRigidbody(_mass, _physicsType, _colType, _group); //<-- adding the group when using triggers, since a trigger should not collide with anything else
        node.addComponent(cmpMesh);
        node.addComponent(cmpMaterial);
        node.addComponent(cmpTransform);
        node.addComponent(cmpRigidbody); // <-- best practice to add physics component last
        return node; //return the full created node
    }
    // Event Function handling keyboard input - similar to Lesson 1 but a little different, since it's pushing the player by force
    function hndKey(_event) {
        let horizontal = 0; //left/right
        let vertical = 0; //front/back
        let height = 0; //upwards/downwards
        //Check keyboard input from Event
        if (_event.code == f.KEYBOARD_CODE.A) {
            horizontal -= force;
        }
        if (_event.code == f.KEYBOARD_CODE.D) {
            horizontal += force;
        }
        if (_event.code == f.KEYBOARD_CODE.W) {
            vertical -= force;
        }
        if (_event.code == f.KEYBOARD_CODE.S) {
            vertical += force;
        }
        if (_event.code == f.KEYBOARD_CODE.SPACE) { //Jump
            height += force * 10;
        }
        playerBody.getComponent(f.ComponentRigidbody).applyLinearImpulse(new f.Vector3(horizontal, height, vertical));
    }
    //Step 4 - Receiving and handling the events
    //Event function handling collision - A EVENT_PHYSICS is receiving a f.EventPhysics with infos about the event
    function hndCollisionEventEnter(_event) {
        //_event. keeps a plethora of informations about the event the most interesting are things like 
        /*
          _event.cmpRigidbody -> to identify the body involved in the event, with getContainer().name you get the actual name of the node involved
          _event.normalImpulse -> intensity of the collision good to play a sound that is only as heavy as the collision
          _event.collisionPoint -> the point in the world where the collision is happening to maybe spawn things like particles
          _event.collisionNormal -> the direction the collision is happening often used to correctly rotate spawned things on the colliding surface
        */
        if (_event.cmpRigidbody.getContainer().name == "Player") { //Our Event is happening with the body NODE called "Player"
            f.Debug.log("Player hit me - Collider");
            //We let this collider act like a bumper through this event. We take the event normal and shoot the player away from the bumper on the contact point.
            playerBody.getComponent(f.ComponentRigidbody).applyForceAtPoint(new f.Vector3(_event.collisionNormal.x * 500, _event.collisionNormal.y * 500, _event.collisionNormal.z * 500), _event.collisionPoint);
        }
    }
    function hndCollisionEventExit(_event) {
        if (_event.cmpRigidbody.getContainer().name == "Player") {
            f.Debug.log("Player left me - Collider");
        }
    }
    //Event function handling triggering
    function hndTriggerEventEnter(_event) {
        if (_event.cmpRigidbody.getContainer().name == "Player") {
            f.Debug.log("Player entered me - Trigger");
            playerBody.getComponent(f.ComponentMaterial).material = playerTriggeredMat;
        }
    }
    function hndTriggerEventExit(_event) {
        if (_event.cmpRigidbody.getContainer().name == "Player") {
            f.Debug.log("Player left me - Trigger");
            playerBody.getComponent(f.ComponentMaterial).material = playerDefaultMat;
        }
    }
    //Since the player could fall of we will reset him back with a trigger when he falls down from the plane
    function hndResetTrigger(_event) {
        if (_event.cmpRigidbody.getContainer().name == "Player") {
            playerBody.getComponent(f.ComponentRigidbody).setPosition(new f.Vector3(0, 3, 0)); //Since it's a physics body we have to set position through physics not transform
        }
    }
})(Tutorials_FUDGEPhysics_Lesson1 || (Tutorials_FUDGEPhysics_Lesson1 = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLDhHQUE4RztBQUU5RyxJQUFVLDhCQUE4QixDQXlNdkM7QUEzTUQsOEdBQThHO0FBRTlHLFdBQVUsOEJBQThCO0lBQ3RDLElBQU8sQ0FBQyxHQUFHLFNBQVMsQ0FBQztJQUVyQix5R0FBeUc7SUFFekcsdUJBQXVCO0lBQ3ZCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDdEMsTUFBTSxHQUFHLEdBQXNCLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQywrQ0FBK0M7SUFDaEgsSUFBSSxRQUFvQixDQUFDLENBQUMsMEJBQTBCO0lBQ3BELElBQUksU0FBaUIsQ0FBQyxDQUFDLDJCQUEyQjtJQUdsRCxrQkFBa0I7SUFDbEIsSUFBSSxNQUFNLEdBQWEsSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDLHVFQUF1RTtJQUMzRyxJQUFJLFVBQWtCLENBQUMsQ0FBQyw0RkFBNEY7SUFHcEgsbUJBQW1CO0lBQ25CLElBQUksS0FBSyxHQUFXLEdBQUcsQ0FBQyxDQUFDLDJDQUEyQztJQUNwRSxJQUFJLGdCQUFnQixHQUFlLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNwSCxJQUFJLGtCQUFrQixHQUFlLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxF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USxFQUFFO1lBQ3ZELENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLDZCQUE2QixDQUFDLENBQUM7WUFDM0MsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxRQUFRLEdBQUcsa0JBQWtCLENBQUM7U0FDNUU7SUFDSCxDQUFDO0lBRUQsU0FBUyxtQkFBbUIsQ0FBQyxNQUFzQjtRQUNqRCxJQUFJLE1BQU0sQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFLENBQUMsSUFBSSxJQUFJLFFBQVEsRUFBRTtZQUN2RCxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1lBQ3hDLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLENBQUMsUUFBUSxHQUFHLGdCQUFnQixDQUFDO1NBQzFFO0lBQ0gsQ0FBQztJQUVELHdHQUF3RztJQUN4RyxTQUFTLGVBQWUsQ0FBQyxNQUFzQjtRQUM3QyxJQUFJLE1BQU0sQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFLENBQUMsSUFBSSxJQUFJLFFBQVEsRUFBRTtZQUN2RCxVQUFVLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsaUZBQWlGO1NBQ3JLO0lBQ0gsQ0FBQztBQUVILENBQUMsRUF6TVMsOEJBQThCLEtBQTlCLDhCQUE4QixRQXlNdkMiLCJzb3VyY2VzQ29udGVudCI6WyIvL1JlZmVyZW5jZSBGdWRnZSwgZ2V0dGluZyBjb2RlIGNvbXBsZXRpb24gcmVhZHkgYW5kIGNyZWF0aW5nIGEgc2hvcnRjdXQgZiB0byB3cml0ZSBGdWRnZUNvZGUgbW9yZSBjb21mb3J0YWJseVxyXG5cclxubmFtZXNwYWNlIFR1dG9yaWFsc19GVURHRVBoeXNpY3NfTGVzc29uMSB7XHJcbiAgaW1wb3J0IGYgPSBGdWRnZUNvcmU7XHJcblxyXG4gIC8vR29hbDogTGVhcm4gaG93IHRvIGNyZWF0ZSBhbmQgdXNlIHBoeXNpY3MgYmFzZWQgZXZlbnRzIChDb2xsaXNpb24vVHJpZ2dlcikgdG8gY29udHJvbCBub2RlcyBpbiB0aGUgYXBwLlxyXG5cclxuICAvL0Z1ZGdlIEJhc2ljIFZhcmlhYmxlc1xyXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBpbml0KTtcclxuICBjb25zdCBhcHA6IEhUTUxDYW52YXNFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImNhbnZhc1wiKTsgLy8gVGhlIGh0bWwgZWxlbWVudCB3aGVyZSB0aGUgc2NlbmUgaXMgZHJhd24gdG9cclxuICBsZXQgdmlld1BvcnQ6IGYuVmlld3BvcnQ7IC8vIFRoZSBzY2VuZSB2aXN1YWxpemF0aW9uXHJcbiAgbGV0IGhpZXJhcmNoeTogZi5Ob2RlOyAvLyBZb3UncmUgb2JqZWN0IHNjZW5lIHRyZWVcclxuXHJcblxyXG4gIC8vUGh5c2ljYWwgT2JqZWN0c1xyXG4gIGxldCBib2RpZXM6IGYuTm9kZVtdID0gbmV3IEFycmF5KCk7IC8vIEFycmF5IG9mIGFsbCBwaHlzaWNhbCBvYmplY3RzIGluIHRoZSBzY2VuZSB0byBoYXZlIGEgcXVpY2sgcmVmZXJlbmNlXHJcbiAgbGV0IHBsYXllckJvZHk6IGYuTm9kZTsgLy8gVHJhbnNmb3JtIG9mIGEgYm9keSB0aGF0IGludGVyYWN0cyB3aXRoIHBoeXNpY3MgYnV0IGNhbiBiZSBtb3ZlZCBieSBub3JtYWwgRnVkZ2VUcmFuc2Zvcm1cclxuXHJcblxyXG4gIC8vU2V0dGluZyBWYXJpYWJsZXNcclxuICBsZXQgZm9yY2U6IG51bWJlciA9IDAuNTsgLy9UaGUgYW1vdW50IG9mIG1vdmVtZW50IHdpdGggZWFjaCBrZXlwcmVzc1xyXG4gIGxldCBwbGF5ZXJEZWZhdWx0TWF0OiBmLk1hdGVyaWFsID0gbmV3IGYuTWF0ZXJpYWwoXCJDdWJlXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdENvbG9yZWQobmV3IGYuQ29sb3IoMCwgMCwgMSwgMSkpKTtcclxuICBsZXQgcGxheWVyVHJpZ2dlcmVkTWF0OiBmLk1hdGVyaWFsID0gbmV3IGYuTWF0ZXJpYWwoXCJDdWJlVHJpZ2dlcmVkXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdENvbG9yZWQobmV3IGYuQ29sb3IoMC45LCAwLjEsIDAuMSwgMSkpKTtcclxuXHJcbiAgLy9GdW5jdGlvbiB0byBpbml0aWFsaXplIHRoZSBGdWRnZSBTY2VuZSB3aXRoIGEgY2FtZXJhLCBsaWdodCwgdmlld3BvcnQgYW5kIFBIWVNDSUFMIE9iamVjdHNcclxuICBmdW5jdGlvbiBpbml0KF9ldmVudDogRXZlbnQpOiB2b2lkIHtcclxuXHJcbiAgICBoaWVyYXJjaHkgPSBuZXcgZi5Ob2RlKFwiU2NlbmVcIik7IC8vY3JlYXRlIHRoZSByb290IE5vZGUgd2hlcmUgZXZlcnkgb2JqZWN0IGlzIHBhcmVudGVkIHRvLiBTaG91bGQgbmV2ZXIgYmUgY2hhbmdlZFxyXG5cclxuICAgIC8vI3JlZ2lvbiBQSFlTSUNTXHJcblxyXG4gICAgLy9QSFlTSUNTIC0gU3RlcCAyOiBDcmVhdGUgc29tZSBwaHlzaWNhbCBOb2RlcyB0byBwbGF5IHdpdGggXHJcbiAgICAvL0NyZWF0aW5nIGEgcGh5c2ljYWxseSBzdGF0aWMgZ3JvdW5kIHBsYW5lIGZvciBvdXIgcGh5c2ljcyBwbGF5Z3JvdW5kLiBBIHNpbXBsZSBzY2FsZWQgY3ViZSBidXQgd2l0aCBwaHlzaWNzIHR5cGUgc2V0IHRvIHN0YXRpY1xyXG4gICAgYm9kaWVzWzBdID0gY3JlYXRlQ29tcGxldGVOb2RlKFwiR3JvdW5kXCIsIG5ldyBmLk1hdGVyaWFsKFwiR3JvdW5kXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdENvbG9yZWQobmV3IGYuQ29sb3IoMC4yLCAwLjIsIDAuMiwgMSkpKSwgbmV3IGYuTWVzaEN1YmUoKSwgMCwgZi5QSFlTSUNTX1RZUEUuU1RBVElDKTtcclxuICAgIGJvZGllc1swXS5tdHhMb2NhbC5zY2FsZShuZXcgZi5WZWN0b3IzKDE0LCAwLjMsIDE0KSk7IC8vU2NhbGUgdGhlIGJvZHkgd2l0aCBpdCdzIHN0YW5kYXJkIENvbXBvbmVudFRyYW5zZm9ybVxyXG4gICAgYm9kaWVzWzBdLm10eExvY2FsLnJvdGF0ZVgoNCwgdHJ1ZSk7IC8vR2l2ZSBpdCBhIHNsaWdodCByb3RhdGlvbiBzbyB0aGUgcGh5c2ljYWwgb2JqZWN0cyBhcmUgc2xpZGluZywgYWx3YXlzIGZyb20gbGVmdCB3aGVuIGl0J3MgYWZ0ZXIgYSBzY2FsaW5nXHJcbiAgICBoaWVyYXJjaHkuYXBwZW5kQ2hpbGQoYm9kaWVzWzBdKTsgLy9BZGQgdGhlIG5vZGUgdG8gdGhlIHNjZW5lIGJ5IGFkZGluZyBpdCB0byB0aGUgc2NlbmUtcm9vdFxyXG5cclxuICAgIC8vU3RlcCAxIC0gQ3JlYXRpbmcgYSB0aGUgcGxheWVyIGN1YmUgLSB0byBpbnRlcmFjdCB0byB0cmlnZ2VyLCBDT0xMSURFUlMgYW5kIFRSSUdHRVJTIFxyXG4gICAgYm9kaWVzWzFdID0gY3JlYXRlQ29tcGxldGVOb2RlKFwiUGxheWVyXCIsIHBsYXllckRlZmF1bHRNYXQsIG5ldyBmLk1lc2hDdWJlKCksIDEsIGYuUEhZU0lDU19UWVBFLkRZTkFNSUMpO1xyXG4gICAgcGxheWVyQm9keSA9IGJvZGllc1sxXTsgLy9SZWZlcmVuY2UgdGhpcyBub2RlIHNwZWNpZmljYWxseSBzbyB3ZSBjYW4gYWNjZXNzIGl0IGZvciBpbnB1dCBtb3JlIGVhc2lseVxyXG4gICAgcGxheWVyQm9keS5tdHhMb2NhbC50cmFuc2xhdGUobmV3IGYuVmVjdG9yMygwLCAxLCAwKSk7XHJcbiAgICBoaWVyYXJjaHkuYXBwZW5kQ2hpbGQoYm9kaWVzWzFdKTtcclxuICAgIHBsYXllckJvZHkuZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KS5yb3RhdGlvbkluZmx1ZW5jZUZhY3RvciA9IG5ldyBmLlZlY3RvcjMoMCwgMCwgMCk7IC8vbWFrZSByb3RhdGlvbiBmaXhlZCB0aGUgcGxheWVyIGRvZXMgbm90IHJvdGF0ZVxyXG4gICAgcGxheWVyQm9keS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLmZyaWN0aW9uID0gMTtcclxuXHJcbiAgICAvL1N0ZXAgMiAtIENyZWF0ZSBib2RpZXMgLSBvbmUgdXNlZCBhcyBhIGJ1dHRvbiB3aGVuIGl0IGNvbGxpZGVzIGl0IHdpbGwgYW4gYWN0aW9uIHdpbGwgaGFwcGVuIC0gb25lIGFzIGEgdHJpZ2dlciwgd2hlbiBpdCdzIG92ZXJsYXBwaW5nIGl0IHdpbGwgdHJpZ2dlciBhbiBhY3Rpb25cclxuICAgIC8vVGhlIENvbGxpc2lvbiBFdmVudCBpcyBoYXBwZW5pbmcgb24gYSBjb2xsaXNpb24gc28gYSBub3JtYWwgYm9keSBjYW4gcmVjZWl2ZSBpdFxyXG4gICAgLy9BIHVzZSBjYXNlIGZvciBhIGNvbGxpc2lvbiBldmVudCBpcyBmb3IgZXhhbXBsZSB3aGVuIHRoZSBwbGF5ZXIgaXMgaGl0dGluZyB0aGUgZ3JvdW5kIHRvIHBsYXkgYSBzb3VuZFxyXG4gICAgYm9kaWVzWzJdID0gY3JlYXRlQ29tcGxldGVOb2RlKFwiQ29sbGlkZXJfQnV0dG9uXCIsIG5ldyBmLk1hdGVyaWFsKFwiQ29sbGlkZXJfQnV0dG9uXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdENvbG9yZWQobmV3IGYuQ29sb3IoMC4zLCAwLjMsIDAuNCwgMSkpKSwgbmV3IGYuTWVzaEN1YmUoKSwgMSwgZi5QSFlTSUNTX1RZUEUuU1RBVElDKTtcclxuICAgIGJvZGllc1syXS5tdHhMb2NhbC50cmFuc2xhdGUobmV3IGYuVmVjdG9yMygtMywgMSwgMCkpO1xyXG4gICAgaGllcmFyY2h5LmFwcGVuZENoaWxkKGJvZGllc1syXSk7XHJcblxyXG4gICAgLy9UaGUgVHJpZ2dlciBFdmVudCBpcyBoYXBwZW5pbmcgd2hlbiBib2RpZXMgb3ZlcmxhcCwgc28gd2UgbmVlZCBhIHNwZWNpYWwgYm9keSB0aGF0IGRvZXMgbm90IGNvbGxpZGUgYnV0IG92ZXJsYXBcclxuICAgIC8vU28gaXQgbXVzdCBiZSBpbiB0aGUgUEhZU0lDU19HUk9VUC5UUklHR0VSLCBhbmQgbm9ybWFsbHkgaXQncyBpbnZpc2JsZSwgc28gaXQgaGFzIG5vIG1lc2ggY29tcG9uZW50IG9yIGlzIGZ1bGx5IHRyYW5zcGFyZW50XHJcbiAgICAvL0EgdXNlIGNhc2UgaXMgc29tZXRoaW5nIGxpa2Ugc3Bhd25pbmcgZW5lbWllcyB3aGVuIGEgcGxheWVyIGVudGVycyBhIHJvb20uXHJcbiAgICBib2RpZXNbM10gPSBjcmVhdGVDb21wbGV0ZU5vZGUoXCJUcmlnZ2VyX0J1dHRvblwiLCBuZXcgZi5NYXRlcmlhbChcIlRyaWdnZXJfQnV0dG9uXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdENvbG9yZWQobmV3IGYuQ29sb3IoMC41LCAwLjMsIDAuMiwgMC4zKSkpLCBuZXcgZi5NZXNoQ3ViZSgpLCAxLCBmLlBIWVNJQ1NfVFlQRS5TVEFUSUMsIGYuUEhZU0lDU19HUk9VUC5UUklHR0VSKTtcclxuICAgIGJvZGllc1szXS5tdHhMb2NhbC50cmFuc2xhdGUobmV3IGYuVmVjdG9yMygzLCAxLCAwKSk7XHJcbiAgICBoaWVyYXJjaHkuYXBwZW5kQ2hpbGQoYm9kaWVzWzNdKTtcclxuXHJcbiAgICAvL1RyaWdnZXIgd2hlbiBwbGF5ZXIgaXMgZmFsbGluZyBvZiB0aGUgcGxhbmVcclxuICAgIGJvZGllc1s0XSA9IGNyZWF0ZUNvbXBsZXRlTm9kZShcIlRyaWdnZXJfUmVzZXRcIiwgbmV3IGYuTWF0ZXJpYWwoXCJUcmlnZ2VyX1Jlc2V0XCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdENvbG9yZWQobmV3IGYuQ29sb3IoMC41LCAwLjMsIDAuMiwgMC4zKSkpLCBuZXcgZi5NZXNoQ3ViZSgpLCAxLCBmLlBIWVNJQ1NfVFlQRS5TVEFUSUMsIGYuUEhZU0lDU19HUk9VUC5UUklHR0VSKTtcclxuICAgIGJvZGllc1s0XS5yZW1vdmVDb21wb25lbnQoYm9kaWVzWzRdLmdldENvbXBvbmVudChmLkNvbXBvbmVudE1lc2gpKTsgLy9yZW1vdmluZyB0aGUgbWVzaCB0byBoYXZlIGludmlzaWJsZSB0cmlnZ2VyIC0gc3RhbmRhcmQgcHJhY3RpY2VcclxuICAgIGJvZGllc1s0XS5tdHhMb2NhbC50cmFuc2xhdGUobmV3IGYuVmVjdG9yMygwLCAtNCwgMCkpO1xyXG4gICAgYm9kaWVzWzRdLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMzAsIDEsIDMwKSk7IC8vTWFrZSBpdCBiaWcgZW5vdWdoIHNvIHRoZSBwbGF5ZXIgc2hvdWxkIGhpdCBpdFxyXG4gICAgaGllcmFyY2h5LmFwcGVuZENoaWxkKGJvZGllc1s0XSk7XHJcblxyXG4gICAgLy9TdGVwIDMgLSBBZnRlciBjcmVhdGluZyBvdXIgUGh5c2ljIEV2ZW50IEJvZGllcywgd2UgdGVsbCB0aGVtIHRvIGxpc3RlbiB0byB0aGUgc3BlY2lmaWMgZXZlbnQgaGFwcGVuaW5nXHJcbiAgICAvL1RoZXNlIGV2ZW50cyBhcmUgaGFwcGVuaW5nIG9uIHRoZSBwaHlzaWMgY29tcG9uZW50IG5vdCBvbiB0aGUgbm9kZS4gU28gYmUgc3VyZSB0byBhZGQgdGhlbSB0byB0aGUgY29tcG9uZW50IG5vdCB0byB0aGUgbm9kZVxyXG4gICAgLy9BIGJvZHkgY2FuIHJlY2VpdmUgYSBlbnRlci9leGl0IGV2ZW50LCBhbmQgaXQncyBvbmx5IGhhcHBlbmluZyBvbmNlLiBJZiBhIGJvZHkgaXMgc3RheWluZyBvbiBhIGNvbGxpc2lvbiBvciBpbiBhIHRyaWdnZXIgaXQgbmVlZHMgdG8gYmUgaGFuZGxlZCBtYW51YWxseVxyXG4gICAgYm9kaWVzWzJdLmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkuYWRkRXZlbnRMaXN0ZW5lcihmLkVWRU5UX1BIWVNJQ1MuQ09MTElTSU9OX0VOVEVSLCBobmRDb2xsaXNpb25FdmVudEVudGVyKTtcclxuICAgIGJvZGllc1syXS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLmFkZEV2ZW50TGlzdGVuZXIoZi5FVkVOVF9QSFlTSUNTLkNPTExJU0lPTl9FWElULCBobmRDb2xsaXNpb25FdmVudEV4aXQpO1xyXG4gICAgLypIaW50OiBUaGUgQ29sbGlzaW9uIEV2ZW50IGlzIG9ubHkgaGFwcGVuaW5nIGlmIHRoZSBvYmplY3QgaXMgaGl0dGluZyBpdCBwaHlzaWNhbGx5LCBcclxuICAgICAgU28gS0lORU1BVElDIHZzLiBTVEFUSUMgZG9lcyBub3QgcmVjZWl2ZSBhIGNvbGxpc2lvbiBFdmVudC4gT25seSBEWU5BTUlDIHZzLiBEWU5BTUlDL1NUQVRJQy9LSU5FTUFUSUMsIG5laXRoZXIgZG8gdHdvIEtpbmVtYXRpYyBoaXQgZWFjaCBvdGhlciBub3IgZG8gS2luZW1hdGljL1N0YXRpYy5cclxuICAgICAgSWYgeW91IHJlYWxseSBuZWVkIGEga2luZW1hdGljIGhpdHRpbmcgYSBzdGF0aWMgb2JqZWN0IGFuZCBzdGlsbCBoYXZlIGEgYWN0aW9uLCB1c2UgdHJpZ2dlciwgb3IgbWFrZSB0aGUgb2JqZWN0IG5vdCBzdGF0aWMgYnV0IGR5bmFtaWMgYnV0IHVubW92aW5nIGJ5IGhhdmluZyBhIHJpZGljdWxvdXNseSBoaWdoIHdlaWdodC5cclxuICAgICAgVGhhdHMgd2h5IHdlIHVzZSBhIGR5bmFtaWMgcGxheWVyIGN1YmUgaW5zdGVhZCBvZiBhIGtpbmVtYXRpYyBsaWtlIHdlIGRpZCBpbiBMZXNzb24gMS5cclxuICAgICovXHJcblxyXG4gICAgLy9TYW1lIGFzIGZvciBjb2xsaXNpb24gYSB0cmlnZ2VyIGlzIGFsc28gbGlzdGVuaW5nIG9uIGEgZXZlbnQgdHlwZSBpbiBmb3JtIG9mIGYuRVZFTlRfUEhZU0lDUyBhbmQgYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkXHJcbiAgICBib2RpZXNbM10uZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KS5hZGRFdmVudExpc3RlbmVyKGYuRVZFTlRfUEhZU0lDUy5UUklHR0VSX0VOVEVSLCBobmRUcmlnZ2VyRXZlbnRFbnRlcik7XHJcbiAgICBib2RpZXNbM10uZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KS5hZGRFdmVudExpc3RlbmVyKGYuRVZFTlRfUEhZU0lDUy5UUklHR0VSX0VYSVQsIGhuZFRyaWdnZXJFdmVudEV4aXQpO1xyXG5cclxuICAgIC8vU2V0dGluZyB1cCBvdXIgcmVzZXRcclxuICAgIGJvZGllc1s0XS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLmFkZEV2ZW50TGlzdGVuZXIoZi5FVkVOVF9QSFlTSUNTLlRSSUdHRVJfRU5URVIsIGhuZFJlc2V0VHJpZ2dlcik7XHJcbiAgICAvLyNlbmRyZWdpb24gUEhZU0lDU1xyXG5cclxuXHJcbiAgICAvL1N0YW5kYXJkIEZ1ZGdlIFNjZW5lIEluaXRpYWxpemF0aW9uIC0gQ3JlYXRpbmcgYSBkaXJlY3Rpb25hbCBsaWdodCwgYSBjYW1lcmEgYW5kIGluaXRpYWxpemUgdGhlIHZpZXdwb3J0XHJcbiAgICBsZXQgY21wTGlnaHQ6IGYuQ29tcG9uZW50TGlnaHQgPSBuZXcgZi5Db21wb25lbnRMaWdodChuZXcgZi5MaWdodERpcmVjdGlvbmFsKGYuQ29sb3IuQ1NTKFwiV0hJVEVcIikpKTtcclxuICAgIGNtcExpZ2h0Lm10eFBpdm90Lmxvb2tBdChuZXcgZi5WZWN0b3IzKDAuNSwgLTEsIC0wLjgpKTsgLy9TZXQgbGlnaHQgZGlyZWN0aW9uXHJcbiAgICBoaWVyYXJjaHkuYWRkQ29tcG9uZW50KGNtcExpZ2h0KTtcclxuXHJcbiAgICBsZXQgY21wQ2FtZXJhOiBmLkNvbXBvbmVudENhbWVyYSA9IG5ldyBmLkNvbXBvbmVudENhbWVyYSgpO1xyXG4gICAgY21wQ2FtZXJhLmNsckJhY2tncm91bmQgPSBmLkNvbG9yLkNTUyhcIkdSRVlcIik7XHJcbiAgICBjbXBDYW1lcmEubXR4UGl2b3QudHJhbnNsYXRlKG5ldyBmLlZlY3RvcjMoMiwgMy41LCAxNykpOyAvL01vdmUgY2FtZXJhIGZhciBiYWNrIHNvIHRoZSB3aG9sZSBzY2VuZSBpcyB2aXNpYmxlXHJcbiAgICBjbXBDYW1lcmEubXR4UGl2b3QubG9va0F0KGYuVmVjdG9yMy5aRVJPKCkpOyAvL1NldCB0aGUgY2FtZXJhIG1hdHJpeCBzbyB0aGF0IGl0IGxvb2tzIGF0IHRoZSBjZW50ZXIgb2YgdGhlIHNjZW5lXHJcblxyXG4gICAgdmlld1BvcnQgPSBuZXcgZi5WaWV3cG9ydCgpOyAvL0NyZWF0aW5nIGEgdmlld3BvcnQgdGhhdCBpcyByZW5kZXJlZCBvbnRvIHRoZSBodG1sIGNhbnZhcyBlbGVtZW50XHJcbiAgICB2aWV3UG9ydC5pbml0aWFsaXplKFwiVmlld3BvcnRcIiwgaGllcmFyY2h5LCBjbXBDYW1lcmEsIGFwcCk7IC8vaW5pdGlhbGl6ZSB0aGUgdmlld3BvcnQgd2l0aCB0aGUgcm9vdCBub2RlLCBjYW1lcmEgYW5kIGNhbnZhc1xyXG5cclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlwcmVzc1wiLCBobmRLZXkpOyAvL0FkZGluZyBhIGxpc3RlbmVyIGZvciBrZXlwcmVzcyBoYW5kbGluZ1xyXG5cclxuICAgIC8vUEhZU0lDUyAtIFN0YXJ0IHVzaW5nIHBoeXNpY3MgYnkgdGVsbGluZyB0aGUgcGh5c2ljcyB0aGUgc2NlbmUgcm9vdCBvYmplY3QuIFBoeXNpY3Mgd2lsbCByZWNhbGN1bGF0ZSBldmVyeSB0cmFuc2Zvcm0gYW5kIGluaXRpYWxpemVcclxuICAgIGYuUGh5c2ljcy5hZGp1c3RUcmFuc2Zvcm1zKGhpZXJhcmNoeSk7XHJcblxyXG4gICAgLy9JbXBvcnRhbnQgc3RhcnQgdGhlIGdhbWUgbG9vcCBhZnRlciBzdGFydGluZyBwaHlzaWNzLCBzbyBwaHlzaWNzIGNhbiB1c2UgdGhlIGN1cnJlbnQgdHJhbnNmb3JtIGJlZm9yZSBpdCdzIGZpcnN0IGl0ZXJhdGlvblxyXG4gICAgZi5Mb29wLmFkZEV2ZW50TGlzdGVuZXIoZi5FVkVOVC5MT09QX0ZSQU1FLCB1cGRhdGUpOyAvL1RlbGwgdGhlIGdhbWUgbG9vcCB0byBjYWxsIHRoZSB1cGRhdGUgZnVuY3Rpb24gb24gZWFjaCBmcmFtZVxyXG4gICAgZi5Mb29wLnN0YXJ0KCk7IC8vU3RhcmQgdGhlIGdhbWUgbG9vcFxyXG4gIH1cclxuXHJcbiAgLy9GdW5jdGlvbiB0byBhbmltYXRlL3VwZGF0ZSB0aGUgRnVkZ2Ugc2NlbmUsIGNvbW1vbmx5IGtub3duIGFzIGdhbWVsb29wXHJcbiAgZnVuY3Rpb24gdXBkYXRlKCk6IHZvaWQge1xyXG4gICAgZi5QaHlzaWNzLndvcmxkLnNpbXVsYXRlKCk7IC8vUEhZU0lDUyAtIFNpbXVsYXRlIHBoeXNpY2FsIGNoYW5nZXMgZWFjaCBmcmFtZSwgcGFyYW1ldGVyIHRvIHNldCB0aW1lIGJldHdlZW4gZnJhbWVzXHJcbiAgICB2aWV3UG9ydC5kcmF3KCk7IC8vIERyYXcgdGhlIGN1cnJlbnQgRnVkZ2UgU2NlbmUgdG8gdGhlIGNhbnZhc1xyXG4gIH1cclxuXHJcbiAgLy8gRnVuY3Rpb24gdG8gcXVpY2tseSBjcmVhdGUgYSBub2RlIHdpdGggbXVsdGlwbGUgbmVlZGVkIEZ1ZGdlQ29tcG9uZW50cywgaW5jbHVkaW5nIGEgcGh5c2ljcyBjb21wb25lbnRcclxuICBmdW5jdGlvbiBjcmVhdGVDb21wbGV0ZU5vZGUoX25hbWU6IHN0cmluZywgX21hdGVyaWFsOiBmLk1hdGVyaWFsLCBfbWVzaDogZi5NZXNoLCBfbWFzczogbnVtYmVyLCBfcGh5c2ljc1R5cGU6IGYuUEhZU0lDU19UWVBFLCBfZ3JvdXA6IGYuUEhZU0lDU19HUk9VUCA9IGYuUEhZU0lDU19HUk9VUC5ERUZBVUxULCBfY29sVHlwZTogZi5DT0xMSURFUl9UWVBFID0gZi5DT0xMSURFUl9UWVBFLkNVQkUpOiBmLk5vZGUge1xyXG4gICAgbGV0IG5vZGU6IGYuTm9kZSA9IG5ldyBmLk5vZGUoX25hbWUpOyAvL0NyZWF0aW5nIHRoZSBub2RlXHJcbiAgICBsZXQgY21wTWVzaDogZi5Db21wb25lbnRNZXNoID0gbmV3IGYuQ29tcG9uZW50TWVzaChfbWVzaCk7IC8vQ3JlYXRpbmcgYSBtZXNoIGZvciB0aGUgbm9kZVxyXG4gICAgbGV0IGNtcE1hdGVyaWFsOiBmLkNvbXBvbmVudE1hdGVyaWFsID0gbmV3IGYuQ29tcG9uZW50TWF0ZXJpYWwoX21hdGVyaWFsKTsgLy9DcmVhdGluZyBhIG1hdGVyaWFsIGZvciB0aGUgbm9kZVxyXG4gICAgbGV0IGNtcFRyYW5zZm9ybTogZi5Db21wb25lbnRUcmFuc2Zvcm0gPSBuZXcgZi5Db21wb25lbnRUcmFuc2Zvcm0oKTsgIC8vVHJhbnNmb3JtIGhvbGRpbmcgcG9zaXRpb24vcm90YXRpb24vc2NhbGluZyBvZiB0aGUgbm9kZVxyXG5cclxuICAgIGxldCBjbXBSaWdpZGJvZHk6IGYuQ29tcG9uZW50UmlnaWRib2R5ID0gbmV3IGYuQ29tcG9uZW50UmlnaWRib2R5KF9tYXNzLCBfcGh5c2ljc1R5cGUsIF9jb2xUeXBlLCBfZ3JvdXApOyAvLzwtLSBhZGRpbmcgdGhlIGdyb3VwIHdoZW4gdXNpbmcgdHJpZ2dlcnMsIHNpbmNlIGEgdHJpZ2dlciBzaG91bGQgbm90IGNvbGxpZGUgd2l0aCBhbnl0aGluZyBlbHNlXHJcblxyXG4gICAgbm9kZS5hZGRDb21wb25lbnQoY21wTWVzaCk7XHJcbiAgICBub2RlLmFkZENvbXBvbmVudChjbXBNYXRlcmlhbCk7XHJcbiAgICBub2RlLmFkZENvbXBvbmVudChjbXBUcmFuc2Zvcm0pO1xyXG4gICAgbm9kZS5hZGRDb21wb25lbnQoY21wUmlnaWRib2R5KTsgLy8gPC0tIGJlc3QgcHJhY3RpY2UgdG8gYWRkIHBoeXNpY3MgY29tcG9uZW50IGxhc3RcclxuICAgIHJldHVybiBub2RlOyAvL3JldHVybiB0aGUgZnVsbCBjcmVhdGVkIG5vZGVcclxuICB9XHJcblxyXG4gIC8vIEV2ZW50IEZ1bmN0aW9uIGhhbmRsaW5nIGtleWJvYXJkIGlucHV0IC0gc2ltaWxhciB0byBMZXNzb24gMSBidXQgYSBsaXR0bGUgZGlmZmVyZW50LCBzaW5jZSBpdCdzIHB1c2hpbmcgdGhlIHBsYXllciBieSBmb3JjZVxyXG4gIGZ1bmN0aW9uIGhuZEtleShfZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcclxuICAgIGxldCBob3Jpem9udGFsOiBudW1iZXIgPSAwOyAgLy9sZWZ0L3JpZ2h0XHJcbiAgICBsZXQgdmVydGljYWw6IG51bWJlciA9IDA7IC8vZnJvbnQvYmFja1xyXG4gICAgbGV0IGhlaWdodDogbnVtYmVyID0gMDsgLy91cHdhcmRzL2Rvd253YXJkc1xyXG5cclxuICAgIC8vQ2hlY2sga2V5Ym9hcmQgaW5wdXQgZnJvbSBFdmVudFxyXG4gICAgaWYgKF9ldmVudC5jb2RlID09IGYuS0VZQk9BUkRfQ09ERS5BKSB7XHJcbiAgICAgIGhvcml6b250YWwgLT0gZm9yY2U7XHJcbiAgICB9XHJcbiAgICBpZiAoX2V2ZW50LmNvZGUgPT0gZi5LRVlCT0FSRF9DT0RFLkQpIHtcclxuICAgICAgaG9yaXpvbnRhbCArPSBmb3JjZTtcclxuICAgIH1cclxuICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuVykge1xyXG4gICAgICB2ZXJ0aWNhbCAtPSBmb3JjZTtcclxuICAgIH1cclxuICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuUykge1xyXG4gICAgICB2ZXJ0aWNhbCArPSBmb3JjZTtcclxuICAgIH1cclxuICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuU1BBQ0UpIHsgLy9KdW1wXHJcbiAgICAgIGhlaWdodCArPSBmb3JjZSAqIDEwO1xyXG4gICAgfVxyXG4gICAgcGxheWVyQm9keS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLmFwcGx5TGluZWFySW1wdWxzZShuZXcgZi5WZWN0b3IzKGhvcml6b250YWwsIGhlaWdodCwgdmVydGljYWwpKTtcclxuICB9XHJcblxyXG5cclxuICAvL1N0ZXAgNCAtIFJlY2VpdmluZyBhbmQgaGFuZGxpbmcgdGhlIGV2ZW50c1xyXG4gIC8vRXZlbnQgZnVuY3Rpb24gaGFuZGxpbmcgY29sbGlzaW9uIC0gQSBFVkVOVF9QSFlTSUNTIGlzIHJlY2VpdmluZyBhIGYuRXZlbnRQaHlzaWNzIHdpdGggaW5mb3MgYWJvdXQgdGhlIGV2ZW50XHJcbiAgZnVuY3Rpb24gaG5kQ29sbGlzaW9uRXZlbnRFbnRlcihfZXZlbnQ6IGYuRXZlbnRQaHlzaWNzKTogdm9pZCB7XHJcbiAgICAvL19ldmVudC4ga2VlcHMgYSBwbGV0aG9yYSBvZiBpbmZvcm1hdGlvbnMgYWJvdXQgdGhlIGV2ZW50IHRoZSBtb3N0IGludGVyZXN0aW5nIGFyZSB0aGluZ3MgbGlrZSBcclxuICAgIC8qIFxyXG4gICAgICBfZXZlbnQuY21wUmlnaWRib2R5IC0+IHRvIGlkZW50aWZ5IHRoZSBib2R5IGludm9sdmVkIGluIHRoZSBldmVudCwgd2l0aCBnZXRDb250YWluZXIoKS5uYW1lIHlvdSBnZXQgdGhlIGFjdHVhbCBuYW1lIG9mIHRoZSBub2RlIGludm9sdmVkIFxyXG4gICAgICBfZXZlbnQubm9ybWFsSW1wdWxzZSAtPiBpbnRlbnNpdHkgb2YgdGhlIGNvbGxpc2lvbiBnb29kIHRvIHBsYXkgYSBzb3VuZCB0aGF0IGlzIG9ubHkgYXMgaGVhdnkgYXMgdGhlIGNvbGxpc2lvblxyXG4gICAgICBfZXZlbnQuY29sbGlzaW9uUG9pbnQgLT4gdGhlIHBvaW50IGluIHRoZSB3b3JsZCB3aGVyZSB0aGUgY29sbGlzaW9uIGlzIGhhcHBlbmluZyB0byBtYXliZSBzcGF3biB0aGluZ3MgbGlrZSBwYXJ0aWNsZXNcclxuICAgICAgX2V2ZW50LmNvbGxpc2lvbk5vcm1hbCAtPiB0aGUgZGlyZWN0aW9uIHRoZSBjb2xsaXNpb24gaXMgaGFwcGVuaW5nIG9mdGVuIHVzZWQgdG8gY29ycmVjdGx5IHJvdGF0ZSBzcGF3bmVkIHRoaW5ncyBvbiB0aGUgY29sbGlkaW5nIHN1cmZhY2VcclxuICAgICovXHJcbiAgICBpZiAoX2V2ZW50LmNtcFJpZ2lkYm9keS5nZXRDb250YWluZXIoKS5uYW1lID09IFwiUGxheWVyXCIpIHsgLy9PdXIgRXZlbnQgaXMgaGFwcGVuaW5nIHdpdGggdGhlIGJvZHkgTk9ERSBjYWxsZWQgXCJQbGF5ZXJcIlxyXG4gICAgICBmLkRlYnVnLmxvZyhcIlBsYXllciBoaXQgbWUgLSBDb2xsaWRlclwiKTtcclxuICAgICAgLy9XZSBsZXQgdGhpcyBjb2xsaWRlciBhY3QgbGlrZSBhIGJ1bXBlciB0aHJvdWdoIHRoaXMgZXZlbnQuIFdlIHRha2UgdGhlIGV2ZW50IG5vcm1hbCBhbmQgc2hvb3QgdGhlIHBsYXllciBhd2F5IGZyb20gdGhlIGJ1bXBlciBvbiB0aGUgY29udGFjdCBwb2ludC5cclxuICAgICAgcGxheWVyQm9keS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLmFwcGx5Rm9yY2VBdFBvaW50KG5ldyBmLlZlY3RvcjMoX2V2ZW50LmNvbGxpc2lvbk5vcm1hbC54ICogNTAwLCBfZXZlbnQuY29sbGlzaW9uTm9ybWFsLnkgKiA1MDAsIF9ldmVudC5jb2xsaXNpb25Ob3JtYWwueiAqIDUwMCksIF9ldmVudC5jb2xsaXNpb25Qb2ludCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBobmRDb2xsaXNpb25FdmVudEV4aXQoX2V2ZW50OiBmLkV2ZW50UGh5c2ljcyk6IHZvaWQge1xyXG4gICAgaWYgKF9ldmVudC5jbXBSaWdpZGJvZHkuZ2V0Q29udGFpbmVyKCkubmFtZSA9PSBcIlBsYXllclwiKSB7XHJcbiAgICAgIGYuRGVidWcubG9nKFwiUGxheWVyIGxlZnQgbWUgLSBDb2xsaWRlclwiKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vRXZlbnQgZnVuY3Rpb24gaGFuZGxpbmcgdHJpZ2dlcmluZ1xyXG4gIGZ1bmN0aW9uIGhuZFRyaWdnZXJFdmVudEVudGVyKF9ldmVudDogZi5FdmVudFBoeXNpY3MpOiB2b2lkIHtcclxuICAgIGlmIChfZXZlbnQuY21wUmlnaWRib2R5LmdldENvbnRhaW5lcigpLm5hbWUgPT0gXCJQbGF5ZXJcIikge1xyXG4gICAgICBmLkRlYnVnLmxvZyhcIlBsYXllciBlbnRlcmVkIG1lIC0gVHJpZ2dlclwiKTtcclxuICAgICAgcGxheWVyQm9keS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRNYXRlcmlhbCkubWF0ZXJpYWwgPSBwbGF5ZXJUcmlnZ2VyZWRNYXQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBobmRUcmlnZ2VyRXZlbnRFeGl0KF9ldmVudDogZi5FdmVudFBoeXNpY3MpOiB2b2lkIHtcclxuICAgIGlmIChfZXZlbnQuY21wUmlnaWRib2R5LmdldENvbnRhaW5lcigpLm5hbWUgPT0gXCJQbGF5ZXJcIikge1xyXG4gICAgICBmLkRlYnVnLmxvZyhcIlBsYXllciBsZWZ0IG1lIC0gVHJpZ2dlclwiKTtcclxuICAgICAgcGxheWVyQm9keS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRNYXRlcmlhbCkubWF0ZXJpYWwgPSBwbGF5ZXJEZWZhdWx0TWF0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy9TaW5jZSB0aGUgcGxheWVyIGNvdWxkIGZhbGwgb2Ygd2Ugd2lsbCByZXNldCBoaW0gYmFjayB3aXRoIGEgdHJpZ2dlciB3aGVuIGhlIGZhbGxzIGRvd24gZnJvbSB0aGUgcGxhbmVcclxuICBmdW5jdGlvbiBobmRSZXNldFRyaWdnZXIoX2V2ZW50OiBmLkV2ZW50UGh5c2ljcyk6IHZvaWQge1xyXG4gICAgaWYgKF9ldmVudC5jbXBSaWdpZGJvZHkuZ2V0Q29udGFpbmVyKCkubmFtZSA9PSBcIlBsYXllclwiKSB7XHJcbiAgICAgIHBsYXllckJvZHkuZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KS5zZXRQb3NpdGlvbihuZXcgZi5WZWN0b3IzKDAsIDMsIDApKTsgLy9TaW5jZSBpdCdzIGEgcGh5c2ljcyBib2R5IHdlIGhhdmUgdG8gc2V0IHBvc2l0aW9uIHRocm91Z2ggcGh5c2ljcyBub3QgdHJhbnNmb3JtXHJcbiAgICB9XHJcbiAgfVxyXG5cclxufSJdfQ==